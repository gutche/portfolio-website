---
import ambientAudio from "../assets/ambient.mp3";
---

<div class="w-14">
  <div class="absolute inset-0 bg-black z-0 blur-[1px] shadow-[0_1px_1px_rgba(255,255,255,0.3)] rounded-[6px]"></div>
  <button
    id="muteButton"
    class="z-10 relative p-2 bg-neutral-900 w-full h-14 shadow-[inset_0_-1px_4px_rgba(0,0,0,0.45),_inset_0_1px_2px_rgba(255,255,255,0.3)] rounded-[4px] focus active:shadow-[inset_0_-1px_4px_rgba(0,0,0,0.45)] active:scale-[0.99] transition-all duration-200"
    aria-label="Toggle audio"
  >
    <div class="h-full w-full flex items-center justify-center rounded-full bg-neutral-900 blur-[2px] shadow-[inset_0_2px_4px_rgba(255,255,255,0.2),_0_5px_4px_rgba(0,0,0,0.75)]"></div>
    <span class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-base uppercase pt-1 whitespace-nowrap">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" width="16" height="16" class="unmuted">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" stroke="currentColor" />
      </svg>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" width="16" height="16" class="muted hidden">
        <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75 19.5 12m0 0 2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6 4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" stroke="currentColor" />
      </svg>
    </span>
    <span class="absolute top-1.5 right-1.5 w-1.5 h-1.5 bg-[#FFF9FB] rounded-full blur-[0.4px] shadow-[0_0_10.4px_#00FF0A,0_0_3.2px_#00FF0A,0_0_3.2px_#00FF0A]"></span>
  </button>
  <audio id="bgAudio" src={ambientAudio} loop preload="auto"></audio>
</div>

<script>
  let isPlaying = false;
  const audio = document.getElementById('bgAudio') as HTMLAudioElement;
  const muteButton = document.getElementById('muteButton');
  const mutedIcon = document.querySelector('.muted');
  const unmutedIcon = document.querySelector('.unmuted');

  const toggleAudio = () => {
    if (!isPlaying) {
      audio.play()
        .then(() => {
          isPlaying = true;
          mutedIcon?.classList.add('hidden');
          unmutedIcon?.classList.remove('hidden');
        })
        .catch(error => {
          console.error('Error playing audio:', error);
        });
    } else {
      audio.pause();
      isPlaying = false;
      mutedIcon?.classList.remove('hidden');
      unmutedIcon?.classList.add('hidden');
    }
  };

  muteButton?.addEventListener('click', toggleAudio);

  document.addEventListener('astro:before-swap', () => {
    muteButton?.removeEventListener('click', toggleAudio);
  });
</script>

<style>
  .muted, .unmuted {
    width: 20px;
    height: 20px;
  }
</style> 