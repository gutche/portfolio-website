---
import { skills } from "../../data/skills";

interface Props {
    class?: string;
}

const { class: className } = Astro.props;
---

<div class={`tab-panel ${className}`} data-tab="skills">
    <div class="flex flex-col gap-2">
        {skills.map((skill) => (
            <button
                class="skill-item p-3 text-left hover:bg-neutral-800/50 transition-colors duration-200"
                data-skill-id={skill.id}
                data-title={skill.title}
                data-description={skill.description}
                data-technologies={skill.technologies}
                data-icon={skill.icon}
            >
                <span class="font-medium">{skill.title}</span>
            </button>
        ))}
    </div>
</div>

<script>
    // Get all skill items
    const skillItems = document.querySelectorAll('.skill-item');

    // Add selected class to first skill by default
    const firstSkill = document.querySelector('.skill-item');
    if (firstSkill) {
        firstSkill.classList.add('selected');
    }

    // Function to play switch sound
    const playSwitchSound = () => {
        const switchSound = document.getElementById("switch-sound") as HTMLAudioElement;
        const audioIndicator = document.getElementById('audioIndicator');
        if (switchSound && audioIndicator?.classList.contains('shadow-[0_0_10.4px_#00FF0A,0_0_3.2px_#00FF0A,0_0_3.2px_#00FF0A]')) {
            switchSound.currentTime = 0;
            switchSound.play().catch((e) => console.log("Error playing sound:", e));
        }
    };

    skillItems.forEach(item => {
        item.addEventListener('click', () => {
            // Remove selected class from all skills
            skillItems.forEach(skill => {
                skill.classList.remove('selected');
            });
            
            // Add selected class to clicked skill
            item.classList.add('selected');
            
            const title = item.getAttribute('data-title');
            const description = item.getAttribute('data-description');
            const technologies = item.getAttribute('data-technologies');
            const icon = item.getAttribute('data-icon');
            
            // Update desktop CRT
            const crtContainer = document.querySelector('.crt-container');
            if (crtContainer && (crtContainer as any).crtEffect) {
                (crtContainer as any).crtEffect.updateImage(icon);
                (crtContainer as any).crtEffect.updateText(title, `${description}\n\nTechnologies: ${technologies}`);
            }
            
            // Update mobile CRT
            const mobileCrtContainer = document.querySelector('.crt-container-mobile');
            if (mobileCrtContainer && (mobileCrtContainer as any).crtEffect) {
                (mobileCrtContainer as any).crtEffect.updateImage(icon);
                (mobileCrtContainer as any).crtEffect.updateText(title, `${description}\n\nTechnologies: ${technologies}`);
            }
            
            // Play switch sound
            playSwitchSound();
        });
    });
</script>

<style>
    .skill-item {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .skill-item:hover {
        background: rgba(0, 0, 0, 0.3);
    }

    .skill-item.selected {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }
</style> 